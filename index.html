<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Provides an R interface to the Substrait cross-language
  serialization for relational algebra.">
<title>Substrait Cross-Language Serialization for Relational Algebra • substrait</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Substrait Cross-Language Serialization for Relational Algebra">
<meta property="og:description" content="Provides an R interface to the Substrait cross-language
  serialization for relational algebra.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">substrait</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="substrait">substrait<a class="anchor" aria-label="anchor" href="#substrait"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of substrait is to provide an R interface to the <a href="https://substrait.io" class="external-link">Substrait</a> cross-language serialization for relational algebra. This is an experimental package that is under heavy development!</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of substrait from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"voltrondata/substrait-r"</span><span class="op">)</span></code></pre></div>
<p>You will need a <a href="https://arrow.apache.org/docs/r/articles/developers/setup.html" class="external-link">development version of the arrow package</a> to actually evaluate anything (in particular, with Arrow configured using <code>-DARROW_ENGINE=ON</code>).</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Basic construction of a Substrait plan and evaluating it using the Arrow Substrait consumer:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">substrait</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>

<span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/arrow_substrait_compiler.html">arrow_substrait_compiler</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mpg_plus_one <span class="op">=</span> <span class="va">mpg</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">wt</span>, <span class="va">mpg_plus_one</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 32 × 3</span>
<span class="co">#&gt;      mpg    wt mpg_plus_one</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;</span>
<span class="co">#&gt;  1  21    2.62         22  </span>
<span class="co">#&gt;  2  21    2.88         22  </span>
<span class="co">#&gt;  3  22.8  2.32         23.8</span>
<span class="co">#&gt;  4  21.4  3.22         22.4</span>
<span class="co">#&gt;  5  18.7  3.44         19.7</span>
<span class="co">#&gt;  6  18.1  3.46         19.1</span>
<span class="co">#&gt;  7  14.3  3.57         15.3</span>
<span class="co">#&gt;  8  24.4  3.19         25.4</span>
<span class="co">#&gt;  9  22.8  3.15         23.8</span>
<span class="co">#&gt; 10  19.2  3.44         20.2</span>
<span class="co">#&gt; # … with 22 more rows</span></code></pre></div>
<p>You can inspect the Plan that will be generated by saving the result and calling <code>$plan()</code>. This doesn’t require a special Arrow build.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">compiler</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>col1 <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/substrait_compiler.html">substrait_compiler</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mpg_plus_one <span class="op">=</span> <span class="va">col1</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">compiler</span><span class="op">$</span><span class="fu">plan</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; message of type 'substrait.Plan' with 3 fields set</span>
<span class="co">#&gt; extension_uris {</span>
<span class="co">#&gt;   extension_uri_anchor: 1</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; extensions {</span>
<span class="co">#&gt;   extension_function {</span>
<span class="co">#&gt;     extension_uri_reference: 1</span>
<span class="co">#&gt;     function_anchor: 2</span>
<span class="co">#&gt;     name: "+"</span>
<span class="co">#&gt;   }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; relations {</span>
<span class="co">#&gt;   rel {</span>
<span class="co">#&gt;     project {</span>
<span class="co">#&gt;       input {</span>
<span class="co">#&gt;         read {</span>
<span class="co">#&gt;           base_schema {</span>
<span class="co">#&gt;             names: "col1"</span>
<span class="co">#&gt;             struct_ {</span>
<span class="co">#&gt;               types {</span>
<span class="co">#&gt;                 i32 {</span>
<span class="co">#&gt;                 }</span>
<span class="co">#&gt;               }</span>
<span class="co">#&gt;             }</span>
<span class="co">#&gt;           }</span>
<span class="co">#&gt;           named_table {</span>
<span class="co">#&gt;             names: "named_table_1"</span>
<span class="co">#&gt;           }</span>
<span class="co">#&gt;         }</span>
<span class="co">#&gt;       }</span>
<span class="co">#&gt;       expressions {</span>
<span class="co">#&gt;         selection {</span>
<span class="co">#&gt;           direct_reference {</span>
<span class="co">#&gt;             struct_field {</span>
<span class="co">#&gt;             }</span>
<span class="co">#&gt;           }</span>
<span class="co">#&gt;         }</span>
<span class="co">#&gt;       }</span>
<span class="co">#&gt;       expressions {</span>
<span class="co">#&gt;         scalar_function {</span>
<span class="co">#&gt;           function_reference: 2</span>
<span class="co">#&gt;           args {</span>
<span class="co">#&gt;             selection {</span>
<span class="co">#&gt;               direct_reference {</span>
<span class="co">#&gt;                 struct_field {</span>
<span class="co">#&gt;                 }</span>
<span class="co">#&gt;               }</span>
<span class="co">#&gt;             }</span>
<span class="co">#&gt;           }</span>
<span class="co">#&gt;           args {</span>
<span class="co">#&gt;             literal {</span>
<span class="co">#&gt;               fp64: 1</span>
<span class="co">#&gt;             }</span>
<span class="co">#&gt;           }</span>
<span class="co">#&gt;           output_type {</span>
<span class="co">#&gt;           }</span>
<span class="co">#&gt;         }</span>
<span class="co">#&gt;       }</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;   }</span>
<span class="co">#&gt; }</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-substrait-proto-objects">Create ‘Substrait’ proto objects<a class="anchor" aria-label="anchor" href="#create-substrait-proto-objects"></a>
</h2>
<p>You can create Substrait proto objects using the <code>substrait</code> base object or using <code><a href="reference/substrait_create.html">substrait_create()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">substrait</span><span class="op">$</span><span class="va">Type</span><span class="op">$</span><span class="va">Boolean</span><span class="op">$</span><span class="fu">create</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; message of type 'substrait.Type.Boolean' with 0 fields set</span>
<span class="fu"><a href="reference/substrait_create.html">substrait_create</a></span><span class="op">(</span><span class="st">"substrait.Type.Boolean"</span><span class="op">)</span>
<span class="co">#&gt; message of type 'substrait.Type.Boolean' with 0 fields set</span></code></pre></div>
<p>You can convert an R object <em>to</em> a Substrait object using <code>as_substrait(object, type)</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/as_substrait.html">as_substrait</a></span><span class="op">(</span><span class="fl">4L</span>, <span class="st">"substrait.Expression"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; message of type 'substrait.Expression' with 1 field set</span>
<span class="co">#&gt; literal {</span>
<span class="co">#&gt;   i32: 4</span>
<span class="co">#&gt; }</span></code></pre></div>
<p>The <code>type</code> can be either a string of the qualified name or an object (which is needed to communicate certain types like <code>"substrait.Expression.Literal.Decimal"</code> which has a <code>precision</code> and <code>scale</code> in addition to the <code>value</code>).</p>
<p>Restore an R object <em>from</em> a Substrait object using <code>from_substrait(message, prototype)</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/as_substrait.html">from_substrait</a></span><span class="op">(</span><span class="va">msg</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 4</span></code></pre></div>
<p>Substrait objects are list-like (i.e., methods defined for <code>[[</code> and <code>$</code>), so you can get or set fields. Note that unset is different than <code>NULL</code> (just like an R list).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">msg</span><span class="op">$</span><span class="va">literal</span> <span class="op">&lt;-</span> <span class="va">substrait</span><span class="op">$</span><span class="va">Expression</span><span class="op">$</span><span class="va">Literal</span><span class="op">$</span><span class="fu">create</span><span class="op">(</span>i32 <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span>
<span class="va">msg</span>
<span class="co">#&gt; message of type 'substrait.Expression' with 1 field set</span>
<span class="co">#&gt; literal {</span>
<span class="co">#&gt;   i32: 5</span>
<span class="co">#&gt; }</span></code></pre></div>
<p>The constructors are currently implemented using about 1000 lines of auto-generated code made by inspecting the nanopb-compiled .proto files and RProtoBuf. This is probably not the best final approach but allows us to get started writing good <code><a href="reference/as_substrait.html">as_substrait()</a></code> and <code><a href="reference/as_substrait.html">from_substrait()</a></code> methods for various types of R objects.</p>
</div>
<div class="section level2">
<h2 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a>
</h2>
<p>Substrait objects are represented as a classed version of the <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code> vector containing serialized data. This makes the representation independent from the protocol buffer library use to encode/deocde the objects and is particularly useful with <code>expect_identical()</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">msg</span><span class="op">)</span>
<span class="co">#&gt; [1] 0a 02 28 05</span></code></pre></div>
<p>Currently, the <a href="https://cran.r-project.org/package=RProtoBuf" class="external-link">RProtoBuf</a> package is used to serialize and deserialize objects. The RProtoBuf package provides excellent coverage of the protocol buffer API and is well-suited to general use; however, the Substrait package only uses a small portion of these features. The package registers the .proto files from Substrait (of which this package has an internal copy) so that you can use RProtobuf to read, modify, and write messages independent of the constructors in the package.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">msg_rpb</span> <span class="op">&lt;-</span> <span class="fu">RProtoBuf</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RProtoBuf/man/P.html" class="external-link">P</a></span><span class="op">(</span><span class="st">"substrait.Type"</span><span class="op">)</span><span class="op">$</span><span class="fu">read</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="va">msg</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; message of type 'substrait.Type' with 1 field set</span>
<span class="fu"><a href="reference/as_substrait.html">as_substrait</a></span><span class="op">(</span><span class="va">msg_rpb</span><span class="op">)</span>
<span class="co">#&gt; message of type 'substrait.Type' with 1 field set</span>
<span class="co">#&gt; bool_ {</span>
<span class="co">#&gt;   5: 5</span>
<span class="co">#&gt; }</span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing substrait</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Dewey Dunnington <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-9415-4582" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Nic Crane <br><small class="roles"> Author </small>  </li>
<li>Jonathan Keane <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/voltrondata/substrait-r/actions" class="external-link"><img src="https://github.com/voltrondata/substrait-r/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/voltrondata/substrait-r?branch=master" class="external-link"><img src="https://codecov.io/gh/voltrondata/substrait-r/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dewey Dunnington, Nic Crane, Jonathan Keane.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
